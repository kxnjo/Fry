{% extends "index.html" %}
{% block content %}
<div class="container mt-5">
    <h1>{{ game.game_title }}</h1>
    <h5><strong>Developed By:</strong>
        {% for developer in developers %}
        <a href="{{ url_for('developer_bp.view_developer', developer_id=developer.developer_id) }}"
           class="text-decoration-none">
            {{ developer.developer_name }}{% if not loop.last %}, {% endif %}
        </a>
        {% endfor %}
    </h5>
    <h5><strong>Release Date:</strong> {{ game.game_release_date }}</h5>
    <h5><strong>Price:</strong> ${{ game.game_price }}</h5>
    <h5><strong>Categories:</strong>
        {% for category in categories %}
        <a href="{{ url_for('category_bp.view_category', category_id=category.category_id) }}"
           class="text-decoration-none">
            {{ category.category_name }}{% if not loop.last %}, {% endif %}
        </a>
        {% else %}
        <div class="alert alert-warning" role="alert">
            No categories found.
        </div>
    </h5>
    {% endfor %}
</div>

<div class="container">
    <div class="row">
        <div class="col-sm-8"></div>
        <div class="col-sm">
<!--            Only visible if logged in-->
            {% if user_logged_in %}
            <form method="POST" action="{{ url_for('wishlist_bp.addToWishlist') }}">
                <input type="text" name="game" value="{{ game.game_id }}" hidden>
                <button type="submit" class="btn btn-light"
                        {% if gameInWishlist %} disabled {% endif %}>
                    {% if gameInWishlist %} Already Added to Wishlist
                    {% else %} Add to Wishlist
                    {% endif %}
                </button>
            </form>
            <br>
            <form method="POST" action="{{ url_for('owned_game_bp.add_owned_game') }}">
                <!-- <input type="text" name="user" value="u20" hidden> -->
                <input type="text" name="game" value="{{ game.game_id }}" hidden>
                <button type="submit" class="btn btn-outline-primary">Add to Owned Games</button>
            </form>
        </div>
    </div>
</div>

<br>
<br>

<!--Show Reviews-->
<!-- Show Reviews -->
<div class="container">
    <h1>Reviews</h1>
    <div class="col">
        {% if user_owned %}
        {% if get_user_review %}
        <p>You already reviewed this game.</p>
        <div class="card review-card mb-3">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-muted">Date: {{ get_user_review[2] }}</h6>
                <p class="card-text">{{ get_user_review[3] }}</p>
                {% if get_user_review[4] == 'TRUE' %}
                <span class="text-success">Recommended</span>
                {% else %}
                <span class="text-danger">Not Recommended</span>
                {% endif %}
            </div>
            <!-- Update Button -->
            <div class="row">
                <div class="col">
                    <a href="{{ url_for('review_bp.edit_reviews', game_id=game.game_id, review_id=get_user_review[0]) }}"
                       class="btn btn-warning btn-sm w-100">Update Review</a>
                </div>
                <div class="col">
                    <a href="{{ url_for('review_bp.delete_review', review_id=get_user_review[0]) }}"
                       class="btn btn-danger btn-sm w-100">Delete Review</a>
                </div>
            </div>
        </div>
        {% else %}
        <form method="GET" action="{{ url_for('review_bp.edit_reviews', game_id=game.game_id) }}">
            <button type="submit" class="btn btn-primary">Add Review</button>
        </form>
        {% endif %}
        {% else %}
        <div class="alert alert-warning" role="alert">
            You can only leave a review after owning the game.
        </div>
        {% endif %}
    <!-- End of Logged In check-->
        {% endif %}

    </div>
    <!--    shown to all-->
    <!-- Recommended and Not Recommended Reviews Section -->
    <div class="row">
        <div class="col-sm">
            <h6>Recommended: {{ recommended_data.true_count }}</h6>
            <ul class="list-group">
                {% for review in reviews if review.recommended == "RECOMMENDED" %}
                <div class="card review-card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">User: {{ review.user_id }}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">Review ID: {{ review.review_id }}</h6>
                        <h6 class="card-subtitle mb-2 text-muted">Date: {{ review.review_date }}</h6>
                        <p class="card-text">{{ review.review_text }}</p>
                        <span class="text-success">Recommended</span>
                    </div>
                </div>
                {% endfor %}
            </ul>
        </div>

        <div class="col-sm">
            <h6>Not Recommended: {{ recommended_data.false_count }}</h6>
            <ul class="list-group">
                {% for review in reviews if review.recommended == "NOT RECOMMENDED" %}
                <div class="card review-card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">User: {{ review.user_id }}</h5>
                        <h6 class="card-subtitle mb-2 text-muted">Review ID: {{ review.review_id }}</h6>
                        <h6 class="card-subtitle mb-2 text-muted">Date: {{ review.review_date }}</h6>
                        <p class="card-text">{{ review.review_text }}</p>
                        <span class="text-danger">Not Recommended</span>
                    </div>
                </div>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>

{% endblock %}
