{% extends "index.html" %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center">
        <h2>User Management</h2>
        
        <!-- Search and Filter Form -->
        <form class="form-inline" method="GET" action="/admin/search_users">
            <div class="input-group">
                <input type="text" class="form-control" name="search" placeholder="Search users...">
                <button type="submit" class="btn btn-primary">Search</button>
                <button type="button" class="btn btn-secondary ml-2">Filter</button>
            </div>
        </form>
    </div>

    <!-- Create User Form -->
    <form id="create-user-form" method="POST" action="/admin/create_user">
        <!-- Form fields here -->
    </form>

    <!-- User Table -->
    <table class="table table-striped mt-4">
        <thead>
            <tr>
                <th scope="col">UID</th>
                <th scope="col">Username</th>
                <th scope="col">Email</th>
                <th scope="col">Date Created</th>
                <th scope="col">Role</th>
                <th scope="col">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.user_id }}</td>
                <td>{{ user.username }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.created_on }}</td>
                <td>{{ user.role }}</td>
                <td>
                    <!-- Button to Trigger Modal -->
					<button type="button" class="btn btn-warning btn-sm d-inline" data-bs-toggle="modal" data-bs-target="#editUserModal{{user.user_id}}">Edit Account</button>

					<!-- Button to Trigger Delete Modal -->
					<button type="button" class="btn btn-danger btn-sm d-inline" data-bs-toggle="modal" data-bs-target="#deleteUserModal{{user.user_id}}">Delete Account</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Pagination Controls -->
    <nav aria-label="Page navigation">
        <ul class="pagination">
            <!-- Previous Page Button -->
            <li class="page-item {% if page <= 1 %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('user_bp.dashboard', page=page-1) }}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>

            <!-- Page Number Buttons -->
            {% for p in range(1, total_pages + 1) %}
            <li class="page-item {% if p == page %}active{% endif %}">
                <a class="page-link" href="{{ url_for('user_bp.dashboard', page=p) }}">{{ p }}</a>
            </li>
            {% endfor %}

            <!-- Next Page Button -->
            <li class="page-item {% if page >= total_pages %}disabled{% endif %}">
                <a class="page-link" href="{{ url_for('user_bp.dashboard', page=page+1) }}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </nav>

    {% for user in users %}

    <!-- Modal for Editing User Details {{user.user_id}}-->
    <div class="modal fade" id="editUserModal{{user.user_id}}" tabindex="-1" aria-labelledby="editUserModalLabel{{user.user_id}}" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form action="{{ url_for('user_bp.edit_user', user_id=user.user_id) }}" method="POST">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editUserModalLabel">Edit User Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body"> 
                        <!-- Username Field -->
                        <div class="mb-3">
                            <label for="username" class="form-label">Username</label>
                            <input type="text" class="form-control" id="username" name="username" value="{{ user.username }}" required />
                        </div>

                        <!-- Email Field -->
                        <div class="mb-3">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal for Deleting User {{user.user_id}}-->
    <div class="modal fade" id="deleteUserModal{{user.user_id}}" tabindex="-1" aria-labelledby="deleteUserModalLabel{{user.user_id}}" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteUserModalLabel">Confirm Account Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Are you sure you want to delete your account? This action cannot be undone.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <!-- Form for Deleting User -->
                    <form action="{{ url_for('user_bp.delete_user', user_id=user.user_id) }}" method="POST">
                        <button type="submit" class="btn btn-danger">Confirm Delete</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}

</div>
{% endblock %}
