{% extends "index.html" %} {% block content %}
<div class="container mt-4">
	<ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
		<li class="nav-item" role="presentation">
			<a class="nav-link {% if filter_type == 'accounts' %}active{% endif %}" id="user-tab" data-bs-toggle="tab" href="#user-management" role="tab" aria-controls="user-management" aria-selected="{{ 'true' if filter_type == 'accounts' else 'false' }}">User Management</a>
		</li>
		<li class="nav-item" role="presentation">
			<a class="nav-link {% if filter_type == 'games' %}active{% endif %}" id="game-tab" data-bs-toggle="tab" href="#game-management" role="tab" aria-controls="game-management" aria-selected="{{ 'true' if filter_type == 'games' else 'false' }}">Game Management</a>
		</li>
	</ul>

	<div class="tab-content" id="dashboardTabContent">
		<!-- User Management Tab -->
		<div class="tab-pane fade {% if filter_type == 'accounts' %}show active{% endif %}" id="user-management" role="tabpanel" aria-labelledby="user-tab">
			<h2 class="mt-4">User Management</h2>
			<!-- User Table -->
			<table class="table table-striped mt-4">
				<thead>
					<tr>
						<th scope="col">UID</th>
						<th scope="col">Username</th>
						<th scope="col">Email</th>
						<th scope="col">Date Created</th>
						<th scope="col">Role</th>
						<th scope="col">Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for user in users %}
					<tr>
						<td>{{ user.user_id }}</td>
						<td>{{ user.username }}</td>
						<td>{{ user.email }}</td>
						<td>{{ user.created_on }}</td>
						<td>{{ user.role }}</td>
						<td>
							<button type="button" class="btn btn-warning btn-sm d-inline" data-bs-toggle="modal" data-bs-target="#editUserModal{{user.user_id}}">Edit Account</button>
							<button type="button" class="btn btn-danger btn-sm d-inline" data-bs-toggle="modal" data-bs-target="#deleteUserModal{{user.user_id}}">Delete Account</button>
						</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>

			<!-- Pagination for Users -->
			<nav aria-label="User page navigation">
				<ul class="pagination">
					<li class="page-item {% if page <= 1 %}disabled{% endif %}">
						<a class="page-link" href="{{ url_for('user_bp.dashboard', page=page-1, filter_type='accounts') }}" aria-label="Previous">
							<span aria-hidden="true">&laquo;</span>
						</a>
					</li>
					{% for p in range(1, user_total_pages + 1) %}
					<li class="page-item {% if p == page %}active{% endif %}">
						<a class="page-link" href="{{ url_for('user_bp.dashboard', page=p, filter_type='accounts') }}">{{ p }}</a>
					</li>
					{% endfor %}
					<li class="page-item {% if page >= user_total_pages %}disabled{% endif %}">
						<a class="page-link" href="{{ url_for('user_bp.dashboard', page=page+1, filter_type='accounts') }}" aria-label="Next">
							<span aria-hidden="true">&raquo;</span>
						</a>
					</li>
				</ul>
			</nav>
		</div>

		<!-- Game Management Tab -->
		<div class="tab-pane fade {% if filter_type == 'games' %}show active{% endif %}" id="game-management" role="tabpanel" aria-labelledby="game-tab">
			<h2 class="mt-4">Game Management</h2>
			<!-- Game Table -->
			<table class="table table-striped mt-4">
				<thead>
					<tr>
						<th scope="col">Game ID</th>
						<th scope="col">Game Title</th>
						<th scope="col">Release Date</th>
						<th scope="col">Price</th>
						<th scope="col">Actions</th>
					</tr>
				</thead>
				<tbody>
					{% for game in games %}
					<tr>
						<td>{{ game.game_id }}</td>
						<td>{{ game.title }}</td>
						<td>{{ game.release_date }}</td>
						<td>{{ game.price }}</td>
						<td>
							<button type="button" class="btn btn-warning btn-sm d-inline" data-bs-toggle="modal" data-bs-target="#editGameModal{{game.game_id}}">Edit Game</button>
						</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>

			<!-- Pagination for Games -->
			<nav aria-label="Game page navigation">
				<ul class="pagination">
					<li class="page-item {% if page <= 1 %}disabled{% endif %}">
						<a class="page-link" href="{{ url_for('user_bp.dashboard', page=page-1, filter_type='games') }}" aria-label="Previous">
							<span aria-hidden="true">&laquo;</span>
						</a>
					</li>
					{% for p in range(1, game_total_pages + 1) %}
					<li class="page-item {% if p == page %}active{% endif %}">
						<a class="page-link" href="{{ url_for('user_bp.dashboard', page=p, filter_type='games') }}">{{ p }}</a>
					</li>
					{% endfor %}
					<li class="page-item {% if page >= game_total_pages %}disabled{% endif %}">
						<a class="page-link" href="{{ url_for('user_bp.dashboard', page=page+1, filter_type='games') }}" aria-label="Next">
							<span aria-hidden="true">&raquo;</span>
						</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>


	<!-- Modals for User Management -->
	{% for user in users %}
		<!-- Modal for Editing User Details -->
		<div class="modal fade" id="editUserModal{{user.user_id}}" tabindex="-1" aria-labelledby="editUserModalLabel{{user.user_id}}" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<form action="{{ url_for('user_bp.edit_user', user_id=user.user_id) }}" method="POST">
						<div class="modal-header">
							<h5 class="modal-title">Edit User Details</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<!-- Username Field -->
							<div class="mb-3">
								<label for="username" class="form-label">Username</label>
								<input type="text" class="form-control" id="username" name="username" value="{{ user.username }}" required />
							</div>
							<!-- Email Field -->
							<div class="mb-3">
								<label for="email" class="form-label">Email</label>
								<input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required />
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
							<button type="submit" class="btn btn-primary">Save Changes</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<!-- Modal for Deleting User -->
		<div class="modal fade" id="deleteUserModal{{user.user_id}}" tabindex="-1" aria-labelledby="deleteUserModalLabel{{user.user_id}}" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Confirm Account Deletion</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<p>Are you sure you want to delete this account? This action cannot be undone.</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
						<a href="{{ url_for('user_bp.delete_user', user_id=user.user_id) }}" class="btn btn-danger">Confirm Delete</a>
					</div>
				</div>
			</div>
		</div>
	{% endfor %}

	<!-- Modals for Game Management -->
	{% for game in games %}
		<!-- Modal for Editing Game Details -->
		<div class="modal fade" id="editGameModal{{game.game_id}}" tabindex="-1" aria-labelledby="editGameModalLabel{{game.game_id}}" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<form action="{{ url_for('game_bp.edit_game', game_id=game.game_id) }}" method="POST">
						<div class="modal-header">
							<h5 class="modal-title">Edit Game Details</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<!-- Game Title Field -->
							<div class="mb-3">
								<label for="title" class="form-label">Game Title</label>
								<input type="hidden" class ="form-control" id="game_id" name="game_id" value = "{{game.game_id}}">
								<input type="text" class="form-control" id="title" name="title" value="{{ game.title }}" required />
							</div>
							<!-- Release Date Field -->
							<div class="mb-3">
								<label for="release_date" class="form-label">Release Date</label>
								<input type="date" class="form-control" id="release_date" name="release_date" value="{{ game.release_date }}" disabled />
							</div>
							<!-- Price Field -->
							<div class="mb-3">
								<label for="price" class="form-label">Price</label>
								<input type="text" class="form-control" id="price" name="price" value="{{ game.price }}" required />
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
							<button type="submit" class="btn btn-primary">Save Changes</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	{% endfor %}
</div>
{% endblock %}
